<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabliss Custom Config</title>
    <script>
        function openDB() {
            return new Promise((resolve, reject) => {
                let request = indexedDB.open("tabliss", 1);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject("IndexedDB error");
            });
        }

        function saveConfig(db) {
            return new Promise((resolve, reject) => {
                let transaction = db.transaction(["config"], "readwrite");
                let store = transaction.objectStore("config");
                
                let configData = {
                    "background": { "id": "default-unsplash", "key": "background/unsplash", "display": { "luminosity": -0.2, "blur": 0 } },
                    "data/default-greeting": { "name": "Jer" },
                    "data/default-time": { "mode": "digital", "hour12": false, "showDate": true, "showMinutes": true, "showSeconds": true, "showDayPeriod": true, "timeZone": null },
                    "widget/default-greeting": { "id": "default-greeting", "key": "widget/greeting", "order": 0, "display": { "position": "topCentre", "fontSize": 34, "colour": "#49a29c", "fontWeight": 100 } },
                    "widget/default-time": { "id": "default-time", "key": "widget/time", "order": 1, "display": { "position": "middleCentre", "fontSize": 22, "fontWeight": 900, "colour": "#ffffff" } }
                };

                let putRequest = store.put(configData, "changes");
                putRequest.onsuccess = () => resolve();
                putRequest.onerror = () => reject("Failed to save config");
            });
        }

        async function applySettings() {
            try {
                let db = await openDB();
                await saveConfig(db);
                window.location.href = "https://web.tabliss.io/";
            } catch (error) {
                console.error(error);
                document.body.innerHTML = "<h1>Fout bij laden van instellingen</h1>";
            }
        }

        window.onload = applySettings;
    </script>
</head>
<body>
    <h1>Tabliss wordt geladen met jouw instellingen...</h1>
</body>
</html>
